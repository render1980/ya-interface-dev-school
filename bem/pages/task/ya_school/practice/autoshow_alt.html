<!doctype html>
<html class="b-page">
<head>
	<meta charset="UTF-8">
	<title>Автосалон (скрипт на Perl)</title>
	<link rel="stylesheet" type="text/css" href="../../../index/index.css">	
	<script type="text/javascript" src="../../../all/all.js"></script> 
</head>
<body class="b-page">	
	<div class="b-wrapper">
		<div class="b-header">
			<div class="b-header__logo">
				<h1>YA_DEV</h1>
			</div>
		</div>

		<div class="b-nav">
			<ul class="b-top_menu">
				<li  class="b-top_menu__item ">
					<a href="../../../index/index.html" class="b-top_menu__item_color_white b-top_menu__item_decoration_none">Главная</a>
				</li>
				<li  class="b-top_menu__item">
					<a href="../../../task/task.html" class="b-top_menu__item_color_white">Проекты</a>
				</li>
				<li  class="b-top_menu__item">
					<a href="../../../site/site.html" class="b-top_menu__item_color_white b-top_menu__item_decoration_none">О сайте</a>
				</li>
				<li class="b-top_menu__item">
					<a href="../../../author/author.html" class="b-top_menu__item_color_white b-top_menu__item_decoration_none">Об авторе</a>
				</li>
			</ul>
		</div>

		<div class="b-main">
			<div class="b-main__article">
				<h3>Автосалон</h3>
					<div class="b-code">
					<pre>
#!/usr/bin/perl
use LWP::Simple;
my $in_file_path = 'in.js';
my $out_file_path = 'out.js';
my $url = 'http://www.cbr.ru/currency_base/D_print.aspx?date_req=';
my $euro_to_rub_rate = 'var euroToRubleRate = ';
my $yen_to_rub_rate = 'var yenToRubleRate = ';

($day, $month, $year) = (localtime)[3, 4, 5];
my $today = sprintf("%02d.%02d.%04d\n", $day, $month+1,$year+1900);

my $content = get $url.$today;

$euro_to_rub_rate .= search_currency_value('EUR', $content).';';
$yen_to_rub_rate .= search_currency_value('JPY', $content).';';

$in_file_data = get_file_data($in_file_path);
$out_data = "$euro_to_rub_rate\n$yen_to_rub_rate\n\n$in_file_data";

write_data_to_file($out_data, $out_file_path);

#поиск текущего значения валюты по отношению к рублю
sub search_currency_value {
    $templ = $_[1];
    $templ =~ /\Q$_[0]\E(.*?)(\n(.*)){2}\n&lttd align="right"&gt(.*?)&gt/;
    $cur_to_rub = $4;
    $cur_to_rub =~ s/,/./g;
    return $cur_to_rub;
}

sub get_file_data {
    open(IN_FILE, $_[0]);
    foreach $str(<IN_FILE>) { 
        $result .= $str; 
    } 
    close IN_FILE;
    return $result;
}

sub write_data_to_file {
    open(OUT_FILE, '>', $_[1]) or die "WTF?!?!!";
    print OUT_FILE $_[0];
    close OUT_FILE;
}
					</pre>
				</div>
			<p><b>Примечание:</b> здесь следует отметить, что шаблон, используемый в регулярном выражении в функции search_currency_value, привязан к представлению данных html разметки на странице, которая парсится. Следовательно, использовать скрипт можно только тогда, когда известна разметка страницы с текущим курсом рубля.</p>
				
			</div>
		</div>
		<div class="b-wrapper__blank"></div>

	</div>
	<div class="b-footer">
		<ul class="b-bottom_menu">
			<li class="b-bottom_menu__item"><a href="../../../site/sitemap.html">Карта сайта</a></li>
			<li class="b-bottom_menu__item"><a href="../../../author/author.html">Об авторе</a></li>
			<li class="b-bottom_menu__item"><a href="../../../author/contacts.html">Контакты</a></li>
		</ul>
	</div>
</body>
</html>
