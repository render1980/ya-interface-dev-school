<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Что происходит при клике на ссылку (более подробно)</title>
	<link rel="stylesheet" href="css/style.css">
	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/jquery.dropdownPlain.js"></script>
	<script type="text/javascript">
		if(navigator.userAgent.indexOf("MSIE 9.0") > 0){
			document.write("<link rel='stylesheet' href='css/ie_style.css'>");
		}
	</script>
</head>
<body>
	<div id="wrapper">
		<div id="header">
			<div id="logo">
				<a href="index.html"><h1>YA_DEV</h1></a>
			</div>			
		</div>

		<div id="nav">
			<ul id="top_menu">
				<li><a href="index.html"><div class="menu_elem">Главная</div></a></li>
				<li>
					<a href=""><div class="menu_elem">Проекты<div class="arrow"></div></div></a>
					<ul>
						<li>
							<a href="ya_school.html">Школа интерфейсов Яндекс</a>
						</li>							
					</ul>
				</li>
				<li><a href=""><div class="menu_elem">О сайте<div class="arrow"></div></div></a>
					<ul>
						<li><a href="common_info.html">Общая информация</a></li>
						<li><a href="sitemap.html">Карта сайта</a></li>
					</ul>
				</li>
				<li><div id="last"><a href="author.html"><div class="menu_elem">Об авторе<div class="arrow"></div></div></a></div>
					<ul>
						<li><a href="resume.html">Резюме</a></li>
						<li><a href="contacts.html">Контакты</a></li>
					</ul>
				</li>
			</ul>
		</div>

		<div id="main">
			<div class="article">
				<h2>Что происходит при клике на ссылку (высокий уровень детализации)</h2>
				
				<p>Можно схематично представить основные компоненты браузера:</p>
				<p><img src="img/browser_components.png"></p>

				<p>Далее постараюсь наиболее подробно описать процесс, начиная от клика по ссылке yandex (например, со страницы с результатами поиска в гугле по слову "yandex" ) и заканчивая отрисовкой страницы на экране.</p>
				
				<ol>
					<li>Клик по ссылке инициирует событие, которое принимается движком браузера и делегируется графическому движку</li>
					<li>Графический движок подгружает html-парсер, который получает значение атрибута href дескриптора &lta&gt, извлекая данные из структуры DOM-дерева страницы, полученного после синтаксического анализа html-кода.
						<ul>
							<li>Дескриптор &lta&gt и его атрибут href привязаны к объектам в DOM-дереве, построенным на этапе загрузки страницы</li>
							<li>После парсинга производится обращение к runtime-instance объекту (структура/класс), описывающей аттрибут href и оттуда извлекается значение</li>
							<li>Необходимые для операции данные сохраняются на время сеанса или кэшируются</li>
						</ul>
					</li>
					<li>Производится поиск запрашиваемой страницы в кэше, или, если не нашлось, то в HOST (C:\WINDOWS\system32\drivers\etc\hosts)</li>
					<li>Далее в дело вступает компонент, реализующий функции для работы с сетью. Он же осущестляет и кэширование полученных данных.</li>
					<li>Если поиск не дал результатов, запрашивается ip-адрес у ближайшего DNS веб-сервера.</li>
					<li>Формируется структура сокета: ip + порт</li>
					<li>Производится соединение с сервером при использовании сокета (минуя промежуточные сервера)</li>
					<li>Если сервер доступен, то формируется http-сообщение с заголовком вида (взято из профайлера браузера Mozilla):</li>
					<p>
						<div class="http_mes">
						<pre>
GET / HTTP/1.1                           
Host: www.yandex.ru				  
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20100101 Firefox/15.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 
Accept-Language: ru-ru,ru;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referrer: [адрес, откуда осуществлен переход (если таковой имеется)]
Cookie: (если используются)
						</pre>						
						</div>
					</p>	
					<li> Далее браузер слушает порт 80.</li>
					<li>Если сообщение получено и код = 200 (ответ получен), то производится парсинг содержимого (html-парсер)</li>
					<li>Ответ от сервера обычно присылается с заголовком такого вида:</li>
					<p>
						<div class="http_mes">
						<pre>
HTTP/1.1 200 Ok
Via: 1.1 CERBERUS
Connection: Keep-Alive
Proxy-Connection: Keep-Alive
Content-Length: 96770
Expires: Mon, 03 Sep 2012 11:28:47 GMT
Date: Mon, 03 Sep 2012 11:28:47 GMT
Content-Type: text/html; charset=UTF-8
Server: nginx
Cache-Control: no-cache,no-store,max-age=0,must-revalidate
Last-Modified: Mon, 03 Sep 2012 11:28:47 GMT
P3P: policyref="/w3c/p3p.xml", CP="NON DSP ADM DEV PSD IVDo OUR IND STP PHY PRE NAV UNI"
Set-Cookie: t=p; Domain=.yandex.ru; Path=/
x-frame-options: DENY
X-XRDS-Location: http://openid.yandex.ru/server_xrds/
						</pre>
						</div>					
					</p>
					<li>Далее начинается самое интересное. Содержимое запрошенного документа блоками по протоколу сетевого уровня обрабатывается сетевыми средствами браузера.</li>
					<li>Графический движок получает данные, конвертированные на предыдущем этапе, в понятном ему виде.</li>
					<li>Парсинг HTML-кода и преобразование в DOM-дерево
						<ul>
							<li>В ходе лексического анализа символы html разбиваются на токены (открывающие и закрывающие тэги, названия и значения атрибутов). Алгоритм лексического анализа, реализованного в графических движках, представляет собой автомат с конечным числом состояний. Следующее состояние определяется на основе символов входной последовательности предыдущей итерации.</li>
							<li>При помощи синтаксического анализатора HTML весь plain-html преобразуется в DOM-дерево, представляющее собой структуры/экземпляры классов/стандартные типы компилируемых языков. Анализатор находит токен, передает конструктору дерева, переходит к следующему элементу.</li>
						</ul>
					</li>
					<li>На следующем этапе браузер помечает документ как интерактивный и начинает анализ отложенных скриптов, которые необходимо выполнить после завершения анализа документа. Состояние документа меняется на "готово", вызывается событие load.</li>		
					<li>Далее следует анализ css и javascript. Для них также используются предопределенные структуры модуле отображения (графический движок). В отличие от HTML, в CSS используется бесконтекстная грамматика, что позволяет, используя восходящий/нисходящий анализатор, формировать CSS-дерево объектов.</li>
					<li>При обнаружении &ltscript&gt синтаксический анализ документа откладывается до завершения выполнения скрипта. Для внешнего скрипта запрашиваются сетевые ресурсы. Все это происходит синхронно (в HTML 5 можно пометить скрипт как аснхронный для выполнения в другом потоке).</li>
					<li>Далее создается еще одна структура - дерево отображения. В нем визуальные элементы размещаются в том порядке, в каком их необходимо вывести на экран. Дерево отображения является проекцией DOM-дерева и служит для того, чтобы отрисовка содержания выполнялась в правильном порядке. Для построения дерева вычисляются таблицы стилей.</li>
					<li>Для расчета размера и положения объекта отображения при включении в дерево применяется ряд действий (компоновка).</li>
					<li>Далее следует этап рендеринга. Для каждого объекта отображения вызывается метод отрисовки, результат выводится на экран. Для отрисовки используется компонент инфраструктуры пользовательского интерфейса. Отрисовываться может как все дерево целиком, так и отдельные элементы.</li>
					<li>После загрузки и рендеринга страницы основной поток браузера переключается в цикл ожидания событий</li>
					<li>Ну вот, собственно, и все. Результат мы можем лицезреть на экране.</li>
				</ol>
			</div>	
		</div>
		<div id="footer_blank"></div>
	</div>
	<div id="footer">
		<div id="bottom_menu">
			<ul>
				<li><a href="sitemap.html">Карта сайта</a></li>
				<li><a href="author.html">Об авторе</a></li>
				<li><a href="contacts.html">Контакты</a></li>
			</ul>
		</div>
		<div id="copyrigth">
			© copyright 2012
		</div>
	</div>
</body>
</html>
